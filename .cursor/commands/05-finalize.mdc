---
description: Projekt finalisieren, Bugs fixen, testen und mergen
---

# Schritt 5: Finalisierung & Bug-Fixing

## Aufgaben

### 1. Automatisches Bug-Fixing

#### 1.1 Common PayloadCMS Bugs fixen

**WICHTIG:** Cursor soll folgende hÃ¤ufige Fehler automatisch korrigieren:

##### Bug 1: Falsche relationTo Werte

```typescript
// âŒ FALSCH - Cursor macht manchmal:
relationTo: 'media.slug'
relationTo: 'pages.slug'
relationTo: media.slug

// âœ… KORREKT - Muss sein:
relationTo: 'media'
relationTo: 'pages'
```

**Fix-Script ausfÃ¼hren:**
```bash
echo "ğŸ” PrÃ¼fe relationTo Fehler..."

# Finde alle .ts und .tsx Files mit falschen relationTo
grep -r "relationTo.*\.slug" src/ --include="*.ts" --include="*.tsx" || echo "Keine relationTo.slug Fehler gefunden"

# Zeige Files mit Problemen
echo "Files mit potentiellen relationTo Problemen:"
grep -l "relationTo" src/ --include="*.ts" --include="*.tsx" -r
```

**Manuelle Korrektur durch Cursor:**
Gehe durch alle Config-Dateien und prÃ¼fe:
- `src/heroes/config.ts`
- `src/blocks/**/config.ts`
- `src/Header/config.ts`
- `src/Footer/config.ts`

Ersetze alle Instanzen:
```typescript
// Pattern zu suchen und zu ersetzen:
relationTo: 'media.slug'     â†’ relationTo: 'media'
relationTo: 'pages.slug'     â†’ relationTo: 'pages'
relationTo: media            â†’ relationTo: 'media'
relationTo: pages            â†’ relationTo: 'pages'
```

##### Bug 2: Fehlende String Quotes in relationTo

```typescript
// âŒ FALSCH:
relationTo: media
relationTo: pages

// âœ… KORREKT:
relationTo: 'media'
relationTo: 'pages'
```

##### Bug 3: Falsche TypeScript Imports

```typescript
// âŒ FALSCH:
import { HeroBlock as HeroBlockType } from '@/payload-types'
// ... aber dann verwendet als:
data: HeroBlock  // Naming-Konflikt!

// âœ… KORREKT:
import type { HeroBlock as HeroBlockType } from '@/payload-types'
// ... und verwenden als:
data: HeroBlockType
```

##### Bug 4: Fehlende 'use client' Direktiven

Alle Component.tsx Files brauchen:
```typescript
'use client'

import React from 'react'
// ... rest of imports
```

##### Bug 5: Missing CMSLink Props

```typescript
// âŒ FALSCH:
<CMSLink link={button.link}>

// âœ… KORREKT:
<CMSLink {...button.link}>
```

#### 1.2 Automatische Suche & Replace

```bash
echo "ğŸ”§ Automatisches Bug-Fixing..."

# Erstelle Backup vor Ã„nderungen
git add .
git commit -m "backup: before automated bug fixes"

# Suche nach hÃ¤ufigen Fehlern
echo "Suche hÃ¤ufige PayloadCMS Fehler..."
```

```typescript
// FÃ¼hre diese Checks aus:

const bugPatterns = [
  {
    name: 'relationTo mit .slug',
    pattern: /relationTo:\s*['"](\w+)\.slug['"]/g,
    fix: (match, collection) => `relationTo: '${collection}'`,
    files: 'src/**/*.ts'
  },
  {
    name: 'relationTo ohne Quotes',
    pattern: /relationTo:\s*([a-z]+)\s*,/g,
    fix: (match, collection) => `relationTo: '${collection}',`,
    files: 'src/**/*.ts'
  },
  {
    name: 'Fehlende use client',
    pattern: /^import React/m,
    fix: (match) => "'use client'\n\nimport React",
    files: 'src/blocks/**/Component.tsx,src/heroes/**/index.tsx'
  },
];

// FÃ¼r jedes Pattern:
for (const bug of bugPatterns) {
  console.log(`Fixe: ${bug.name}...`);
  // Suche und ersetze in allen betroffenen Files
}
```

### 2. VollstÃ¤ndigkeits-Check

```bash
echo "ğŸ” VollstÃ¤ndigkeits-Check..."

BUILD_CONFIG=$(cat .temp/build-config.json)

# Check Navbar
if [ ! -d "src/Header" ]; then
  echo "âŒ Header Ordner fehlt"
  exit 1
fi
echo "âœ… Header vorhanden"

# Check Footer
if [ ! -d "src/Footer" ]; then
  echo "âŒ Footer Ordner fehlt"
  exit 1
fi
echo "âœ… Footer vorhanden"

# Check Heroes
HERO_COUNT=$(echo $BUILD_CONFIG | jq '.components.heroes | length')
for i in $(seq 0 $(($HERO_COUNT - 1))); do
  HERO_NAME=$(echo $BUILD_CONFIG | jq -r ".components.heroes[$i].name")
  if [ ! -d "src/heroes/${HERO_NAME}" ]; then
    echo "âŒ Hero fehlt: ${HERO_NAME}"
    exit 1
  fi
done
echo "âœ… Alle ${HERO_COUNT} Heroes vorhanden"

# Check Blocks
BLOCK_COUNT=$(echo $BUILD_CONFIG | jq '.components.blocks | length')
for i in $(seq 0 $(($BLOCK_COUNT - 1))); do
  BLOCK_NAME=$(echo $BUILD_CONFIG | jq -r ".components.blocks[$i].name")
  BLOCK_CATEGORY=$(echo $BUILD_CONFIG | jq -r ".components.blocks[$i].category")
  if [ ! -d "src/blocks/${BLOCK_CATEGORY}/${BLOCK_NAME}" ]; then
    echo "âŒ Block fehlt: ${BLOCK_NAME}"
    exit 1
  fi
done
echo "âœ… Alle ${BLOCK_COUNT} Blocks vorhanden"

echo "âœ… VollstÃ¤ndigkeits-Check erfolgreich"
```

### 2. VollstÃ¤ndigkeits-Check

```bash
echo "ğŸ” VollstÃ¤ndigkeits-Check..."

BUILD_CONFIG=$(cat .temp/build-config.json)

# Check Navbar
if [ ! -d "src/Header" ]; then
  echo "âŒ Header Ordner fehlt"
  exit 1
fi
echo "âœ… Header vorhanden"

# Check Footer
if [ ! -d "src/Footer" ]; then
  echo "âŒ Footer Ordner fehlt"
  exit 1
fi
echo "âœ… Footer vorhanden"

# Check Heroes
HERO_COUNT=$(echo $BUILD_CONFIG | jq '.components.heroes | length')
for i in $(seq 0 $(($HERO_COUNT - 1))); do
  HERO_NAME=$(echo $BUILD_CONFIG | jq -r ".components.heroes[$i].name")
  if [ ! -d "src/heroes/${HERO_NAME}" ]; then
    echo "âŒ Hero fehlt: ${HERO_NAME}"
    exit 1
  fi
done
echo "âœ… Alle ${HERO_COUNT} Heroes vorhanden"

# Check Blocks
BLOCK_COUNT=$(echo $BUILD_CONFIG | jq '.components.blocks | length')
for i in $(seq 0 $(($BLOCK_COUNT - 1))); do
  BLOCK_NAME=$(echo $BUILD_CONFIG | jq -r ".components.blocks[$i].name")
  BLOCK_CATEGORY=$(echo $BUILD_CONFIG | jq -r ".components.blocks[$i].category")
  if [ ! -d "src/blocks/${BLOCK_CATEGORY}/${BLOCK_NAME}" ]; then
    echo "âŒ Block fehlt: ${BLOCK_NAME}"
    exit 1
  fi
done
echo "âœ… Alle ${BLOCK_COUNT} Blocks vorhanden"

echo "âœ… VollstÃ¤ndigkeits-Check erfolgreich"
```

### 3. Code-QualitÃ¤t Checks

```bash
echo "ğŸ“ Code-QualitÃ¤t Checks..."

# Check 1: Alle Component.tsx haben 'use client'
echo "PrÃ¼fe 'use client' Direktiven..."
MISSING_USE_CLIENT=$(find src/blocks src/heroes -name "Component.tsx" -o -name "index.tsx" | xargs grep -L "use client" || true)

if [ ! -z "$MISSING_USE_CLIENT" ]; then
  echo "âš ï¸  Folgende Files fehlen 'use client':"
  echo "$MISSING_USE_CLIENT"
  echo "FÃ¼ge 'use client' hinzu..."
  
  # Auto-fix
  for file in $MISSING_USE_CLIENT; do
    if ! grep -q "use client" "$file"; then
      sed -i "1i'use client'\n" "$file"
      echo "âœ… Fixed: $file"
    fi
  done
fi

# Check 2: relationTo Werte
echo "PrÃ¼fe relationTo Werte..."
BAD_RELATION=$(grep -r "relationTo.*\.slug\|relationTo:\s*[a-z]" src/ --include="*.ts" || true)

if [ ! -z "$BAD_RELATION" ]; then
  echo "âš ï¸  Falsche relationTo gefunden:"
  echo "$BAD_RELATION"
  echo ""
  echo "CURSOR: Bitte korrigiere diese Files manuell:"
  echo "- Entferne .slug von relationTo Werten"
  echo "- FÃ¼ge Quotes hinzu: relationTo: 'media' nicht relationTo: media"
fi

# Check 3: TypeScript Syntax
echo "PrÃ¼fe TypeScript Syntax..."
npx tsc --noEmit --skipLibCheck 2>&1 | head -20

echo "âœ… Code-QualitÃ¤t Checks abgeschlossen"
```

### 4. TypeScript Build testen

```bash
echo "ğŸ”¨ Teste TypeScript Build..."

# Types generieren
npm run payload generate:types

# Build ausfÃ¼hren
npm run build

if [ $? -eq 0 ]; then
  echo "âœ… TypeScript Build erfolgreich"
else
  echo "âŒ TypeScript Build fehlgeschlagen"
  exit 1
fi
```

### 3. Payload Admin testen

```bash
echo "ğŸš€ Starte Dev Server fÃ¼r Tests..."
npm run dev &
DEV_PID=$!

# Warte bis Server lÃ¤uft 
sleep 15

echo ""
echo "ğŸ“‹ Manuelle Test-Checkliste:"
echo ""
echo "Ã–ffne: http://localhost:3000/admin"
echo ""
echo "Teste folgendes:"
echo "- [ ] Header Global ist editierbar"
echo "- [ ] Footer Global ist editierbar"
echo "- [ ] Neue Seite kann erstellt werden"
echo "- [ ] Hero Block kann hinzugefÃ¼gt werden"
echo "- [ ] Alle anderen Blocks sind verfÃ¼gbar"
echo "- [ ] ShadCN Button Variants funktionieren"
echo "- [ ] Deutsche Labels Ã¼berall vorhanden"
echo ""
read -p "Tests abgeschlossen? (Enter drÃ¼cken)"

# Dev Server beenden
kill $DEV_PID
echo "âœ… Dev Server gestoppt"
```

### 4. Dokumentation generieren

```typescript
const buildConfig = JSON.parse(
  fs.readFileSync('.temp/build-config.json', 'utf-8')
);

const documentation = `# Website Generierung - Dokumentation

Generiert am: ${new Date().toLocaleString('de-DE')}
Branch: ${buildConfig.branch}

## Konfiguration

### Props
\`\`\`json
${JSON.stringify({
  navbar: buildConfig.components.navbar.name,
  footer: buildConfig.components.footer.name,
  heroes: buildConfig.components.heroes.map(h => h.originalName),
  blocks: buildConfig.components.blocks.map(b => b.name)
}, null, 2)}
\`\`\`

## Komponenten

### Header
- **Komponente**: ${buildConfig.components.navbar.name}
- **Quelle**: ${buildConfig.components.navbar.localPath}
- **Dateien**: MobileNav.tsx, DesktopNav.tsx, config.ts
- **Global**: \`header\`

### Footer
- **Komponente**: ${buildConfig.components.footer.name}
- **Quelle**: ${buildConfig.components.footer.localPath}
- **Dateien**: MobileFooter.tsx, DesktopFooter.tsx, config.ts
- **Global**: \`footer\`

### Heroes (${buildConfig.components.heroes.length})

${buildConfig.components.heroes.map(hero => `- **${hero.originalName}**
  - Komponente: ${hero.name}
  - Quelle: ${hero.localPath}
  - Pfad: \`src/heroes/${hero.name}/\``).join('\n\n')}

### Blocks (${buildConfig.components.blocks.length})

${Object.entries(
  buildConfig.components.blocks.reduce((acc, block) => {
    if (!acc[block.category]) acc[block.category] = [];
    acc[block.category].push(block);
    return acc;
  }, {})
).map(([category, blocks]) => `#### ${category}
${blocks.map(b => `- **${b.name}** (\`src/blocks/${b.category}/${b.name}/\`)`).join('\n')}`).join('\n\n')}

## Button Styling

**WICHTIG**: Alle Buttons verwenden ausschlieÃŸlich ShadCN UI Variants:
- \`default\` - Standard Button (gefÃ¼llt)
- \`outline\` - Button mit Rahmen
- \`ghost\` - Transparenter Button
- \`link\` - Link-Style Button

**KEINE** Custom-Styles!

## Verwendung

### Neue Seite erstellen
1. Admin Panel Ã¶ffnen: \`http://localhost:3000/admin\`
2. "Seiten" â†’ "Neue Seite"
3. Blocks hinzufÃ¼gen (Hero + Content Blocks)
4. Speichern & VerÃ¶ffentlichen

### Header/Footer bearbeiten
1. "Globale Einstellungen"
2. "Kopfzeile" oder "FuÃŸzeile"
3. Bearbeiten & Speichern

## NÃ¤chste Schritte

- [ ] Inhalte im Admin Panel eingeben
- [ ] Logo hochladen
- [ ] Navigation konfigurieren
- [ ] Erste Seiten erstellen
- [ ] Production Deployment
`;

fs.writeFileSync('WEBSITE_GENERATION.md', documentation);
console.log('âœ… Dokumentation erstellt: WEBSITE_GENERATION.md');
```

### 5. README.md aktualisieren

```typescript
const existingReadme = fs.readFileSync('README.md', 'utf-8');

const componentSection = `

## Automatisch generierte Komponenten

Diese Website wurde automatisch generiert mit folgenden Relume Komponenten:

### Navigation & Footer
- **Header**: ${buildConfig.components.navbar.name}
- **Footer**: ${buildConfig.components.footer.name}

### Hero Sektionen (${buildConfig.components.heroes.length})
${buildConfig.components.heroes.map(h => `- ${h.originalName}`).join('\n')}

### Content Blocks (${buildConfig.components.blocks.length})
${Object.entries(
  buildConfig.components.blocks.reduce((acc, block) => {
    if (!acc[block.category]) acc[block.category] = [];
    acc[block.category].push(block.name);
    return acc;
  }, {})
).map(([category, blocks]) => `- **${category}**: ${blocks.join(', ')}`).join('\n')}

Siehe [WEBSITE_GENERATION.md](./WEBSITE_GENERATION.md) fÃ¼r Details.
`;

fs.writeFileSync('README.md', existingReadme + componentSection);
console.log('âœ… README.md aktualisiert');
```

### 6. Git Finalisierung

```bash
# Finale Ã„nderungen
git add .
git add WEBSITE_GENERATION.md
git add README.md

# Finaler Commit
BUILD_CONFIG=$(cat .temp/build-config.json)
BRANCH_NAME=$(cat .temp/current-branch.txt)

git commit -m "docs: finalize website generation

Complete documentation added:
- WEBSITE_GENERATION.md with component list
- README.md updated

Build Status:
âœ… TypeScript build successful
âœ… All migrations executed
âœ… $(echo $BUILD_CONFIG | jq '.components.heroes | length') Heroes
âœ… $(echo $BUILD_CONFIG | jq '.components.blocks | length') Blocks
âœ… ShadCN Button variants used
âœ… Original Relume designs preserved
âœ… German UX labels throughout

Ready for content creation!"

echo "âœ… Finaler Commit erstellt"

# Branch pushen
git push origin $BRANCH_NAME

echo ""
echo "â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•"
echo "  ğŸŠ WEBSITE GENERATION ABGESCHLOSSEN! ğŸŠ"
echo "â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•"
echo ""
echo "Branch: $BRANCH_NAME"
echo ""
echo "NÃ¤chster Schritt: Branch Mergen"
echo ""
echo "git checkout main"
echo "git merge $BRANCH_NAME"
echo "git push origin main"
echo ""
echo "â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•"
```

## Erfolgskriterien

- [ ] Alle Komponenten validiert
- [ ] TypeScript Build erfolgreich
- [ ] Payload Admin funktioniert
- [ ] Dokumentation vollstÃ¤ndig
- [ ] README aktualisiert
- [ ] Git History sauber
- [ ] Branch bereit zum Mergen

## Abschluss

Die Website ist nun vollstÃ¤ndig generiert und bereit fÃ¼r:
1. âœ… Branch Merge in main
2. ğŸ“ Content-Erstellung im Admin Panel
3. ğŸš€ Production Deployment