---
description: Haupt-Workflow für PayloadCMS Website Generierung
globs:
  - "src/**/*.{ts,tsx}"
  - ".cursor/commands/**/*.mdc"
  - ".cursor/relume-mapping.json"
  - "components/ui/**/*.tsx"
alwaysIncludeContext: true
---

# PayloadCMS Website Generator - Haupt-Workflow

Dieser Workflow orchestriert die automatische Generierung einer PayloadCMS Website basierend auf Relume Komponenten aus einem geklonten Git Repository.

## Relume Repository Setup

**WICHTIG:** Stelle sicher, dass das Relume Repository korrekt konfiguriert ist:

```json
// filepath: .cursor/relume-mapping.json
{
  "repository": {
    "url": "https://github.com/your-username/your-relume-repo.git",
    "branch": "main",
    "localPath": ".temp/relume-repo"
  }
}
```

### Authentifizierung

**Für Public Repos:** Keine Auth nötig  
**Für Private Repos:** 
```bash
# SSH Key Setup (einmalig)
git config --global credential.helper store
# oder
ssh-keygen -t ed25519 -C "your_email@example.com"
# SSH Key zu GitHub hinzufügen
```

## Workflow-Schritte

### 0. Initialisierung
**Führe aus:** `.cursor/commands/00-initialize-project.mdc`
- Relume Repository klonen nach `.temp/relume-repo/`
- Repository Struktur validieren
- Projekt-Setup prüfen
- Git Feature Branch erstellen
- Props validieren und normalisieren
- Build Config erstellen (`.temp/build-config.json`)
- Alle Komponenten-Existenz prüfen

### 1. Navbar erstellen
**Führe aus:** `.cursor/commands/01-create-navbar.mdc`
- Navbar Code aus `.temp/relume-repo/relume/Header/` laden
- Code analysieren (Buttons, Mobile Menu, etc.)
- In MobileNav.tsx & DesktopNav.tsx aufteilen
- PayloadCMS config mit deutschen Labels
- ShadCN Buttons verwenden (keine Custom-Styles!)
- Migration durchführen
- Git Commit

### 2. Footer erstellen
**Führe aus:** `.cursor/commands/02-create-footer.mdc`
- Footer Code aus `.temp/relume-repo/relume/Footer/` laden
- Code analysieren
- In MobileFooter.tsx & DesktopFooter.tsx aufteilen
- PayloadCMS config mit Social Media
- ShadCN Buttons & Lucide Icons
- Migration durchführen
- Git Commit

### 3. Heroes erstellen
**Führe aus:** `.cursor/commands/03-create-heroes.mdc`
- Alle Heroes aus `.temp/relume-repo/relume/Header/HeroHeader*.tsx` laden
- **Namen normalisieren:** `Header1` → `HeroHeader1`
- Jeden Hero analysieren
- Shared config.ts mit heroType selector
- Einzelne Hero-Komponenten erstellen
- HeroRenderer mit dynamischem Loading
- ShadCN Button variants
- Migration durchführen
- Git Commit

### 4. Blocks erstellen
**Führe aus:** `.cursor/commands/04-create-blocks.mdc`
- Alle Blocks aus `.temp/relume-repo/relume/{Category}/` laden
- Category auto-detection aus Block-Namen
- Code-Analyse pro Block
- Strukturen erstellen:
  - `src/blocks/{Category}/{BlockName}/Component.tsx`
  - `src/blocks/{Category}/{BlockName}/config.ts`
  - `src/blocks/{Category}/{BlockName}/index.ts`
- BlockRenderer mit dynamischem Loading
- ShadCN Buttons in allen Blocks
- Migration durchführen
- Git Commit

### 5. Finalisierung
**Führe aus:** `.cursor/commands/05-finalize.mdc`
- Vollständigkeits-Check aller Komponenten
- TypeScript Build testen
- Payload Admin manuell testen
- `WEBSITE_GENERATION.md` generieren
- `README.md` aktualisieren
- Finaler Git Commit
- Branch pushen
- Merge-Anleitung ausgeben

## Verwendung

### Basis-Kommando

```bash
cursor run .cursor/tasks/build-website.mdc
```

### Mit Props (Beispiel)

```json
{
  "navbar": "Navbar1",
  "footer": "Footer1", 
  "heroes": ["Header1", "Header2", "HeroHeader5"],
  "blocks": ["Layout1", "CTA2", "FAQ5", "Contact1"]
}
```

## Props Schema

```typescript
interface BuildWebsiteProps {
  navbar: string;      // z.B. "Navbar1"
  footer: string;      // z.B. "Footer1"
  heroes: string[];    // z.B. ["Header1", "HeroHeader5"]
  blocks: string[];    // z.B. ["CTA2", "FAQ5", "Contact1"]
}
```

## Path Resolution

Alle Pfade beziehen sich auf das **geklonte Repository** in `.temp/relume-repo/`:

### Navbar
- Input: `"Navbar1"`
- File: `.temp/relume-repo/relume/Header/Navbar1.tsx`

### Footer
- Input: `"Footer1"`
- File: `.temp/relume-repo/relume/Footer/Footer1.tsx`

### Heroes
- Input: `"Header1"` → Normalisiert zu: `"HeroHeader1"`
- File: `.temp/relume-repo/relume/Header/HeroHeader1.tsx`

### Blocks
- Input: `"CTA2"` → Category: "CTA"
- File: `.temp/relume-repo/relume/CTA/CTA2.tsx`

## ShadCN Button Integration

**WICHTIG:** Alle Buttons verwenden NUR ShadCN Variants!

```tsx
import { Button } from '@/components/ui/button'

// Im Component.tsx
<Button variant={button.variant}>
  {button.text}
</Button>

// In config.ts
{
  name: 'variant',
  type: 'select',
  label: 'Button Stil',
  options: [
    { label: 'Standard', value: 'default' },
    { label: 'Outline', value: 'outline' },
    { label: 'Ghost', value: 'ghost' },
    { label: 'Link', value: 'link' },
  ],
}
```

## Arbeitsverzeichnisse

Während des Workflows werden folgende Temp-Ordner erstellt:

```
.temp/
├── relume-repo/              # Geklontes Relume Repository
├── build-config.json         # Zentrale Build Configuration
├── current-branch.txt        # Feature Branch Name
├── relume-components/        # Kopierte Komponenten für Analyse
│   ├── navbar/
│   ├── footer/
│   ├── heroes/
│   └── blocks/
└── analysis/                 # Code-Analyse JSON Files
    ├── navbar-analysis.json
    ├── footer-analysis.json
    ├── heroes-analysis.json
    └── blocks-analysis.json
```

## Erfolgskriterien

- [ ] Relume Repository erfolgreich geklont
- [ ] Alle Komponenten aus lokalem Repo geladen
- [ ] Relume Designs exakt beibehalten
- [ ] Nur ShadCN Button Variants verwendet
- [ ] Deutsche UX Labels überall
- [ ] Alle Migrationen erfolgreich
- [ ] TypeScript Build ohne Fehler
- [ ] Payload Admin funktioniert
- [ ] Git History sauber

## Troubleshooting

### Repository Clone fehlschlägt
```bash
# Check ob Repo URL korrekt ist
cat .cursor/relume-mapping.json | jq '.repository.url'

# Für private Repos: SSH Key prüfen
ssh -T git@github.com

# Manuell klonen zum Testen
git clone https://github.com/your-username/your-relume-repo.git .temp/test
```

### Komponente nicht gefunden
```bash
# Prüfe ob Datei im geklonten Repo existiert
ls -la .temp/relume-repo/relume/Header/

# Prüfe Build Config
cat .temp/build-config.json | jq '.components.navbar'
```

### Migration fehlgeschlagen
```bash
# Check Migration Logs
npm run payload migrate -- --status

# Re-run Migration
npm run payload migrate
```

## Erweiterbarkeit

Neue Schritte hinzufügen:
1. Command-Datei in `.cursor/commands/` erstellen
2. Hier im Workflow referenzieren
3. Nummerierung beibehalten

Beispiele:
- `06-add-seo.mdc` - SEO Felder
- `07-add-analytics.mdc` - Analytics
- `08-add-forms.mdc` - Formulare