---
description: Automatisches Fixing h√§ufiger PayloadCMS Bugs
---

# Automatische Bug-Fixes f√ºr PayloadCMS Projekt

## H√§ufige Bugs und deren Fixes

### 1. relationTo Fehler

#### Problem:
Cursor generiert manchmal falsche relationTo Werte:
```typescript
// ‚ùå H√§ufige Fehler:
relationTo: 'media.slug'
relationTo: 'pages.slug'
relationTo: media  // ohne Quotes
relationTo: pages  // ohne Quotes
```

#### L√∂sung:
```typescript
// ‚úÖ Korrekt:
relationTo: 'media'
relationTo: 'pages'
relationTo: 'categories'
relationTo: 'posts'
```

#### Auto-Fix Regex:
```bash
# Pattern 1: Entferne .slug
find src/ -type f -name "*.ts" -exec sed -i "s/relationTo: '\([a-z]*\)\.slug'/relationTo: '\1'/g" {} \;

# Pattern 2: F√ºge Quotes hinzu
find src/ -type f -name "*.ts" -exec sed -i "s/relationTo: \([a-z]*\),/relationTo: '\1',/g" {} \;

# Pattern 3: Entferne doppelte Quotes
find src/ -type f -name "*.ts" -exec sed -i "s/relationTo: ''\([a-z]*\)''/relationTo: '\1'/g" {} \;
```

### 2. Fehlende 'use client' Direktive

#### Problem:
React Client Components brauchen 'use client' am Anfang

#### Betroffene Files:
- `src/blocks/**/Component.tsx`
- `src/heroes/**/index.tsx`
- `src/Header/MobileNav.tsx`
- `src/Header/DesktopNav.tsx`
- `src/Footer/MobileFooter.tsx`
- `src/Footer/DesktopFooter.tsx`

#### Auto-Fix:
```bash
# Finde alle Component Files ohne 'use client'
FILES=$(find src/ -name "Component.tsx" -o -name "index.tsx" -o -name "*Nav.tsx" -o -name "*Footer.tsx")

for file in $FILES; do
  if ! grep -q "^'use client'" "$file"; then
    echo "Adding 'use client' to $file"
    sed -i "1i'use client'\n" "$file"
  fi
done
```

### 3. Falsche Type Imports

#### Problem:
```typescript
// ‚ùå FALSCH - Naming Konflikt:
import { HeroBlock } from '@/payload-types'
// sp√§ter in Props:
data: HeroBlock  // Konflikt mit Import!
```

#### L√∂sung:
```typescript
// ‚úÖ KORREKT - Type Alias verwenden:
import type { HeroBlock as HeroBlockType } from '@/payload-types'
// in Props:
data: HeroBlockType
```

#### Auto-Fix Pattern:
Suche in allen Files nach:
```bash
grep -r "import { \(.*\)Block } from '@/payload-types'" src/
```

Ersetze mit:
```bash
import type { {BlockName}Block as {BlockName}BlockType } from '@/payload-types'
```

### 4. CMSLink Props Fehler

#### Problem:
```typescript
// ‚ùå FALSCH:
<CMSLink link={button.link}>

// ‚ùå FALSCH:
<CMSLink href={button.link.url}>
```

#### L√∂sung:
```typescript
// ‚úÖ KORREKT - Spread Props:
<CMSLink {...button.link}>
  {button.text}
</CMSLink>

// ‚úÖ KORREKT - Mit allen Props:
<CMSLink
  type={data.link.type}
  url={data.link.url}
  newTab={data.link.newTab}
>
  {data.text}
</CMSLink>
```

### 5. Media Component Props

#### Problem:
```typescript
// ‚ùå FALSCH:
<Media src={data.image} />
<Media image={data.image} />
<img src={data.image.url} />
```

#### L√∂sung:
```typescript
// ‚úÖ KORREKT:
<Media resource={data.image} />

// Mit className:
<Media 
  resource={data.image} 
  className="w-full object-cover"
/>
```

### 6. Button Variant Typos

#### Problem:
```typescript
// ‚ùå H√§ufige Typos:
variant: 'primary'  // gibt es nicht in ShadCN
variant: 'secondary'  // gibt es nicht in ShadCN
variant: 'outlined'  // Typo
variant: 'text'  // gibt es nicht
```

#### L√∂sung:
```typescript
// ‚úÖ Nur diese ShadCN Variants:
variant: 'default'     // Standard gef√ºllt
variant: 'outline'     // Mit Border
variant: 'ghost'       // Transparent
variant: 'link'        // Als Link
variant: 'destructive' // Rot f√ºr Delete
variant: 'secondary'   // Sekund√§r Style
```

#### Auto-Fix Config:
In allen config.ts Files:
```typescript
{
  name: 'variant',
  type: 'select',
  options: [
    { label: 'Standard', value: 'default' },
    { label: 'Outline', value: 'outline' },
    { label: 'Ghost', value: 'ghost' },
    { label: 'Link', value: 'link' },
  ],
  defaultValue: 'default',
}
```

### 7. Missing Conditional Checks

#### Problem:
```typescript
// ‚ùå Runtime Error wenn undefined:
{data.buttons.map((button) => ...)}
{data.features.map((feature) => ...)}
```

#### L√∂sung:
```typescript
// ‚úÖ Safe mit Optional Chaining:
{data.buttons?.map((button) => ...)}
{data.buttons && data.buttons.length > 0 && (
  <div>
    {data.buttons.map((button) => ...)}
  </div>
)}
```

### 8. Import Path Errors

#### Problem:
```typescript
// ‚ùå Relative Paths:
import { Button } from '../../../components/ui/button'
import { Media } from '../../components/Media'

// ‚ùå Falsche Alias:
import { Button } from 'components/ui/button'
```

#### L√∂sung:
```typescript
// ‚úÖ Konsistente @ Alias:
import { Button } from '@/components/ui/button'
import { Media } from '@/components/Media'
import { CMSLink } from '@/components/CMSLink'
import { RichText } from '@/components/RichText'
```

## Ausf√ºhrungs-Script

```bash
#!/bin/bash
echo "üîß Starte automatisches Bug-Fixing..."

# 1. relationTo Fixes
echo "1Ô∏è‚É£ Fixe relationTo Werte..."
find src/ -type f -name "*.ts" -exec sed -i "s/relationTo: '\([a-z]*\)\.slug'/relationTo: '\1'/g" {} \;
find src/ -type f -name "*.ts" -exec sed -i "s/relationTo: \([a-z]*\),/relationTo: '\1',/g" {} \;

# 2. 'use client' hinzuf√ºgen
echo "2Ô∏è‚É£ F√ºge 'use client' hinzu..."
for file in $(find src/blocks src/heroes src/Header src/Footer -name "*.tsx"); do
  if ! grep -q "^'use client'" "$file" && grep -q "React" "$file"; then
    sed -i "1i'use client'\n" "$file"
    echo "  ‚úÖ Fixed: $file"
  fi
done

# 3. Type Import Checks
echo "3Ô∏è‚É£ Pr√ºfe Type Imports..."
grep -r "import { .*Block } from '@/payload-types'" src/ --include="*.tsx" || echo "  ‚úÖ Keine Import-Konflikte"

# 4. CMSLink Props Check
echo "4Ô∏è‚É£ Pr√ºfe CMSLink Verwendung..."
BAD_CMS_LINK=$(grep -r "<CMSLink link=" src/ --include="*.tsx" || true)
if [ ! -z "$BAD_CMS_LINK" ]; then
  echo "  ‚ö†Ô∏è  Gefunden: <CMSLink link=... ‚Üí Bitte zu <CMSLink {...link}> √§ndern"
  echo "$BAD_CMS_LINK"
fi

# 5. Media Component Check
echo "5Ô∏è‚É£ Pr√ºfe Media Komponente..."
BAD_MEDIA=$(grep -r "<Media src=\|<Media image=" src/ --include="*.tsx" || true)
if [ ! -z "$BAD_MEDIA" ]; then
  echo "  ‚ö†Ô∏è  Gefunden: <Media src/image=... ‚Üí Bitte zu <Media resource=... √§ndern"
  echo "$BAD_MEDIA"
fi

# 6. Button Variant Check
echo "6Ô∏è‚É£ Pr√ºfe Button Variants..."
BAD_VARIANTS=$(grep -r "variant: ['\"]primary\|variant: ['\"]secondary\|variant: ['\"]text" src/ --include="*.tsx" || true)
if [ ! -z "$BAD_VARIANTS" ]; then
  echo "  ‚ö†Ô∏è  Ung√ºltige Button Variants gefunden"
  echo "$BAD_VARIANTS"
fi

# 7. Optional Chaining Check
echo "7Ô∏è‚É£ Pr√ºfe fehlende Optional Chaining..."
MISSING_OPTIONAL=$(grep -r "data\.\w*\.map(" src/ --include="*.tsx" | grep -v "?" || true)
if [ ! -z "$MISSING_OPTIONAL" ]; then
  echo "  ‚ö†Ô∏è  M√∂glicherweise fehlendes Optional Chaining:"
  echo "$MISSING_OPTIONAL"
fi

echo ""
echo "‚úÖ Automatisches Bug-Fixing abgeschlossen!"
echo ""
echo "Bitte manuell pr√ºfen:"
echo "- CMSLink Props (Punkt 4)"
echo "- Media Component Props (Punkt 5)"
echo "- Button Variants (Punkt 6)"
echo "- Optional Chaining (Punkt 7)"
```

## Manuelle Checks (f√ºr Cursor)

Nach dem Auto-Fix Script, gehe durch folgende Files manuell:

### Hero Config Check:
```bash
# √ñffne und pr√ºfe:
src/heroes/config.ts

# Stelle sicher:
- Alle relationTo haben Quotes: relationTo: 'media'
- Keine .slug Suffixe
- Button variant options sind korrekt (default, outline, ghost, link)
```

### Block Configs Check:
```bash
# F√ºr jeden Block:
find src/blocks -name "config.ts"

# Pr√ºfe in jedem:
- relationTo: 'media' (mit Quotes, ohne .slug)
- relationTo: 'pages' (mit Quotes, ohne .slug)
- Button variant options (nur ShadCN Variants)
- Type ist 'select' f√ºr variants
```

### Component Files Check:
```bash
# F√ºr jedes Component.tsx:
find src/blocks src/heroes -name "Component.tsx" -o -name "index.tsx"

# Stelle sicher:
- Hat 'use client' am Anfang
- <Media resource={...} /> nicht <Media src={...} />
- <CMSLink {...link}> nicht <CMSLink link={...}>
- data.array?.map() nicht data.array.map()
- Import paths mit @ Alias
```

## Validierung

Nach allen Fixes:

```bash
# 1. TypeScript Check
npm run build

# 2. Payload Check
npm run dev

# 3. Admin Panel √∂ffnen
# http://localhost:3000/admin
# Neue Seite erstellen
# Hero Block hinzuf√ºgen
# Content Blocks hinzuf√ºgen
# Speichern & Testen
```
